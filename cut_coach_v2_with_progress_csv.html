<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Morning Cut Coach</title>
  <!-- iOS Web App (Webclip) Meta -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Cut Coach" />
  <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='256' height='256'%3E%3Crect width='100%25' height='100%25' fill='%23000000'/%3E%3Ctext x='50%25' y='55%25' font-size='120' fill='%23FFFFFF' text-anchor='middle' font-family='Arial, sans-serif'%3ECC%3C/text%3E%3C/svg%3E" />
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Fallbacks for helper classes so it works even if Tailwind @apply isn't processed */
    html, body { height: 100%; }
    .btn { padding: 0.5rem 1rem; border-radius: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .card { border-radius: 1rem; box-shadow: 0 2px 12px rgba(0,0,0,0.1); padding: 1rem; background: #fff; }
    .muted { color: #64748b; }
    .input { width: 100%; padding: 0.5rem 0.75rem; border-radius: 0.75rem; border: 1px solid #cbd5e1; outline: none; }
  </style>
  <!-- Charts library for progress visuals -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body class="bg-slate-100 text-slate-900">
  <div class="max-w-xl mx-auto p-4 pb-24">
    <header class="flex items-center justify-between mb-4">
      <div>
        <h1 class="text-2xl font-bold">Morning Cut Coach</h1>
        <p class="muted" id="todayLabel">—</p>
      </div>
      <button id="openSettings" class="btn bg-slate-900 text-white">Settings</button>
    </header>

    <!-- Today Card -->
    <section class="card mb-4" id="todayCard">
      <div class="flex items-center justify-between mb-1">
        <h2 class="text-lg font-semibold">Today</h2>
        <span class="muted" id="weekBadge">Week —</span>
      </div>
      <p class="text-sm muted mb-3">6:15–6:45 AM window • Keep 1–2 reps in reserve • Smooth > heroics</p>
      <div class="bg-indigo-50 border border-indigo-200 rounded-xl p-3">
        <div class="text-sm font-semibold">Planned Workout</div>
        <div class="mt-1" id="plannedWorkout">—</div>
      </div>

      <div class="grid grid-cols-2 gap-3 mt-3">
        <button id="intervalHelper" class="btn bg-indigo-600 text-white">Interval Helper</button>
        <button id="startTimer" class="btn bg-emerald-600 text-white">30:00 Timer</button>
      </div>
    </section>

    <!-- Log Card -->
    <section class="card mb-4">
      <h2 class="text-lg font-semibold mb-2">Log Today</h2>
      <div class="grid grid-cols-2 gap-3">
        <div>
          <label class="text-sm muted">Calories</label>
          <input id="caloriesActual" class="input" type="number" inputmode="numeric" placeholder="2300" />
        </div>
        <div>
          <label class="text-sm muted">Protein (g)</label>
          <input id="proteinActual" class="input" type="number" inputmode="numeric" placeholder="170" />
        </div>
        <div>
          <label class="text-sm muted">Fat (g)</label>
          <input id="fatActual" class="input" type="number" inputmode="numeric" placeholder="70" />
        </div>
        <div>
          <label class="text-sm muted">Carbs (g)</label>
          <input id="carbActual" class="input" type="number" inputmode="numeric" placeholder="240" />
        </div>
        <div>
          <label class="text-sm muted">Steps</label>
          <input id="stepsActual" class="input" type="number" inputmode="numeric" placeholder="8000" />
        </div>
        <div>
          <label class="text-sm muted">Weight (lb)</label>
          <input id="weight" class="input" type="number" step="0.1" inputmode="decimal" placeholder="238" />
        </div>
        <div>
          <label class="text-sm muted">Sleep (hrs)</label>
          <input id="sleep" class="input" type="number" step="0.1" inputmode="decimal" placeholder="7.5" />
        </div>
        <div>
          <label class="text-sm muted">Resting HR</label>
          <input id="rhr" class="input" type="number" inputmode="numeric" placeholder="60" />
        </div>
        <div class="col-span-2 flex items-center gap-3 mt-1">
          <input id="didWorkout" type="checkbox" class="h-5 w-5" />
          <label for="didWorkout" class="text-sm">Workout completed</label>
        </div>
        <div class="col-span-2">
          <label class="text-sm muted">Notes</label>
          <textarea id="notes" class="input" rows="2" placeholder="How did it feel?"></textarea>
        </div>
      </div>
      <button id="saveBtn" class="btn bg-slate-900 text-white w-full mt-3">Save</button>
      <p class="text-xs muted mt-2" id="saveStatus">Not saved</p>
    </section>

    <!-- Trend Card (quick stats) -->
    <section class="card mb-4">
      <h2 class="text-lg font-semibold mb-2">Trend</h2>
      <div class="grid grid-cols-2 gap-3 items-end">
        <div class="bg-emerald-50 border border-emerald-200 rounded-xl p-3">
          <div class="text-sm muted">7-day Avg Weight</div>
          <div class="text-2xl font-bold" id="avg7">—</div>
        </div>
        <div class="bg-amber-50 border border-amber-200 rounded-xl p-3">
          <div class="text-sm muted">Calories Target</div>
          <div class="text-2xl font-bold" id="calTarget">—</div>
        </div>
      </div>
      <p class="text-xs muted mt-2">Every 2 weeks: if avg loss &lt; 1 lb/wk → −150 kcal; if &gt; 2 lb/wk or energy poor → +100–150 kcal.</p>
    </section>

    <!-- Progress & History Card -->
    <section class="card mb-4">
      <div class="flex items-center justify-between mb-2">
        <h2 class="text-lg font-semibold">Progress & History</h2>
        <div class="flex gap-2">
          <button id="exportCsvBtn" class="btn bg-slate-100">Export CSV</button>
        </div>
      </div>
      <p class="text-sm muted mb-3">Charts update automatically when you save. Log consistently for a clean trend line.</p>

      <div class="space-y-4">
        <div class="bg-white rounded-xl border border-slate-200 p-3">
          <div class="text-sm font-semibold mb-1">Weight Trend</div>
          <canvas id="weightChart" height="140"></canvas>
        </div>
        <div class="grid grid-cols-1 gap-4">
          <div class="bg-white rounded-xl border border-slate-200 p-3">
            <div class="text-sm font-semibold mb-1">Calories vs Target</div>
            <canvas id="caloriesChart" height="120"></canvas>
          </div>
          <div class="bg-white rounded-xl border border-slate-200 p-3">
            <div class="text-sm font-semibold mb-1">Protein (g)</div>
            <canvas id="proteinChart" height="120"></canvas>
          </div>
        </div>
        <div class="bg-white rounded-xl border border-slate-200 p-3">
          <div class="text-sm font-semibold mb-2">Recent Entries</div>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="text-left text-slate-500">
                  <th class="py-1 pr-3">Date</th>
                  <th class="py-1 pr-3">Wt</th>
                  <th class="py-1 pr-3">Cals</th>
                  <th class="py-1 pr-3">Prot</th>
                  <th class="py-1 pr-3">Steps</th>
                  <th class="py-1 pr-3">WO</th>
                  <th class="py-1 pr-3">Notes</th>
                </tr>
              </thead>
              <tbody id="recentTbody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <footer class="text-center text-xs muted mt-8">
      Built for quick mornings. Keep it smooth.
    </footer>
  </div>

  <!-- Interval Helper Drawer -->
  <div id="drawer" class="fixed inset-0 bg-black/50 hidden">
    <div class="absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl p-4 max-w-xl mx-auto">
      <div class="flex items-center justify-between mb-2">
        <h3 class="text-lg font-semibold">Interval Helper</h3>
        <button id="closeDrawer" class="btn bg-slate-100">Close</button>
      </div>
      <p class="text-sm muted mb-3">Warm up 5 min • Do the run:walk prescription • Cool down 5 min. Never sprint.</p>
      <div class="grid grid-cols-2 gap-3">
        <div class="bg-indigo-50 border border-indigo-200 rounded-xl p-3">
          <div class="text-sm muted">Block (2-week)</div>
          <div id="blockLabel" class="text-xl font-bold">—</div>
        </div>
        <div class="bg-indigo-50 border border-indigo-200 rounded-xl p-3">
          <div class="text-sm muted">Prescription</div>
          <div id="intervalLabel" class="text-xl font-bold">—</div>
        </div>
      </div>
      <div class="mt-3">
        <button id="startIntervals" class="btn w-full bg-indigo-600 text-white">Start Guided Timer</button>
        <p class="text-xs muted mt-2">Guided timer will buzz visually at each segment. Keep phone awake.</p>
        <div id="timerPanel" class="hidden mt-3 bg-black text-white rounded-xl p-4 text-center">
          <div class="text-sm text-white/70" id="timerPhase">—</div>
          <div class="text-5xl font-bold mt-1" id="timer">00:00</div>
          <div class="mt-2 text-xs" id="timerDetail">—</div>
          <button id="stopTimer" class="btn bg-white text-black w-full mt-3">Stop</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settings" class="fixed inset-0 bg-black/50 hidden">
    <div class="absolute inset-x-0 top-10 mx-auto max-w-xl bg-white rounded-2xl p-4">
      <div class="flex items-center justify-between mb-2">
        <h3 class="text-lg font-semibold">Settings</h3>
        <button id="closeSettings" class="btn bg-slate-100">Close</button>
      </div>
      <div class="grid grid-cols-2 gap-3">
        <div>
          <label class="text-sm muted">Start Date</label>
          <input id="startDate" class="input" type="date" />
        </div>
        <div>
          <label class="text-sm muted">Calorie Target</label>
          <input id="caloriesTarget" class="input" type="number" value="2300" />
        </div>
        <div>
          <label class="text-sm muted">Protein Target (g)</label>
          <input id="proteinTarget" class="input" type="number" value="170" />
        </div>
        <div>
          <label class="text-sm muted">Fat Target (g)</label>
          <input id="fatTarget" class="input" type="number" value="70" />
        </div>
      </div>
      <button id="saveSettings" class="btn bg-slate-900 text-white w-full mt-3">Save Settings</button>
      <p class="text-xs muted mt-2">Tip: Set the start date to the Monday you began the plan. iOS: open in Safari → Share → Add to Home Screen for full‑screen web app.</p>
    </div>
  </div>

  <script>
  // ---------- Utilities ----------
  const $ = (id) => document.getElementById(id);
  const fmt = (n) => n.toLocaleString(undefined, { maximumFractionDigits: 1 });
  const todayISO = () => new Date().toISOString().slice(0,10);
  const dow = (d) => ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][d.getDay()];

  // Local storage keys
  const LS = { settings:'cutcoach_settings_v1', logs:'cutcoach_logs_v1' };

  const defaultSettings = () => ({
    startDate: (() => { const now = new Date(); const day = now.getDay(); const diff = (1 + 7 - day) % 7; const nextMon = new Date(now.getFullYear(), now.getMonth(), now.getDate() + diff); return nextMon.toISOString().slice(0,10); })(),
    calTarget: 2300, pTarget: 170, fTarget: 70
  });

  function loadSettings(){ try { return JSON.parse(localStorage.getItem(LS.settings)) || defaultSettings(); } catch { return defaultSettings(); } }
  function saveSettings(s){ localStorage.setItem(LS.settings, JSON.stringify(s)); }
  function loadLogs(){ try { return JSON.parse(localStorage.getItem(LS.logs)) || {}; } catch { return {}; } }
  function saveLogs(l){ localStorage.setItem(LS.logs, JSON.stringify(l)); }

  // ---------- Plan Logic ----------
  function weekNumber(startISO, dateISO){ const start = new Date(startISO + 'T00:00'); const d = new Date(dateISO + 'T00:00'); const days = Math.floor((d - start) / 86400000); return Math.floor(days / 7) + 1; }
  function blockFromWeek(w){ return Math.floor((w - 1) / 2) + 1; }
  const intervalBlocks = {1:'5 up + 1:1 x10 + 5 down',2:'5 up + 2:1 x8 + 5 down',3:'5 up + 3:1 x7 + 5 down',4:'5 up + 4:1 x6 + 5 down',5:'5 up + 2:1 x9 + 5 down',6:'5 up + 3:1 x8 + 5 down',7:'5 up + 4:1 x7 + 5 down',8:'5 up + 5:1 x6 + 5 down',9:'5 up + 3:1 x8 + 5 down',10:'5 up + 4:1 x7 + 5 down',11:'5 up + 5:1 x6 + 5 down',12:'5 up + 6:1 x5 + 5 down'};
  function strengthPrescription(week){ const m={1:[3,12,30],2:[3,15,40],3:[4,12,45],4:[4,15,60],5:[3,12,35],6:[3,15,45],7:[4,12,50],8:[4,15,60],9:[3,12,35],10:[3,15,45],11:[4,12,50],12:[4,15,60]}; return m[blockFromWeek(week)]||[3,12,30]; }

  function plannedWorkoutFor(dateISO, startISO){ const d=new Date(dateISO+'T00:00'); const w=weekNumber(startISO,dateISO); const day=d.getDay(); const [sets,reps,plank]=strengthPrescription(w); if(day===1) return `Strength A — ${sets}x${reps} (+ plank ${plank}s)`; if(day===2) return `Intervals — ${intervalBlocks[blockFromWeek(w)]}`; if(day===3) return `Strength B — ${sets}x${reps} (+ plank ${plank}s)`; if(day===4) return `Intervals — ${intervalBlocks[blockFromWeek(w)]}`; if(day===5) return `Strength A — ${sets}x${reps} (EMOM feel) (+ plank ${plank}s)`; if(day===6) return 'Zone 2 — brisk walk/jog 30 min (nasal breathing)'; if(day===0) return 'Mobility — 30 min hips/hamstrings/T-spine + easy walk'; return ''; }
  function stepsGoalFor(startISO, dateISO){ const w = weekNumber(startISO, dateISO); return Math.min(8000 + Math.floor((w - 1) / 4) * 500, 10000); }

  // ---------- UI State ----------
  const state = { settings: loadSettings(), logs: loadLogs(), today: todayISO(), charts: { weight:null, calories:null, protein:null } };

  function renderToday(){ const t = new Date(state.today + 'T00:00'); const w = weekNumber(state.settings.startDate, state.today); $('todayLabel').textContent = `${t.toDateString()} • ${dow(t)}`; $('weekBadge').textContent = `Week ${w}`; $('plannedWorkout').textContent = plannedWorkoutFor(state.today, state.settings.startDate); $('calTarget').textContent = state.settings.calTarget; $('stepsActual').placeholder = stepsGoalFor(state.settings.startDate, state.today); const L = state.logs[state.today] || {}; ['caloriesActual','proteinActual','fatActual','carbActual','stepsActual','weight','sleep','rhr','notes'].forEach(id=>{ $(id).value = L[id] ?? ''; }); $('didWorkout').checked = !!L.didWorkout; $('avg7').textContent = compute7DayAvg() ?? '—'; $('saveStatus').textContent = 'Not saved'; renderChartsAndTable(); }

  function compute7DayAvg(){ const vals=[]; for(let i=0;i<7;i++){ const d=new Date(state.today+'T00:00'); d.setDate(d.getDate()-i); const k=d.toISOString().slice(0,10); const L=state.logs[k]; if(L&&L.weight){ vals.push(parseFloat(L.weight)); } } if(vals.length<2) return null; const avg = vals.reduce((a,b)=>a+b,0)/vals.length; return fmt(avg); }

  function saveToday(){ const entry={ caloriesActual: $('caloriesActual').value, proteinActual: $('proteinActual').value, fatActual: $('fatActual').value, carbActual: $('carbActual').value, stepsActual: $('stepsActual').value, weight: $('weight').value, sleep: $('sleep').value, rhr: $('rhr').value, didWorkout: $('didWorkout').checked, notes: $('notes').value }; state.logs[state.today]=entry; saveLogs(state.logs); $('saveStatus').textContent='Saved'; $('avg7').textContent=compute7DayAvg() ?? '—'; renderChartsAndTable(); }

  // ---------- Interval Helper ----------
  function parseRx(rx){ const m = rx.match(/(\d+) up \+ (\d+):(\d+) x(\d+) \+ (\d+) down/); if(!m) return null; const [_, up, run, walk, reps, down] = m.map(Number); return { up, run, walk, reps, down }; }
  function showDrawer(){ $('drawer').classList.remove('hidden'); }
  function hideDrawer(){ $('drawer').classList.add('hidden'); stopGuidedTimer(); }
  let timerId=null, phaseQueue=[], phaseIdx=0, remaining=0; function startGuidedTimer(){ const w = weekNumber(state.settings.startDate, state.today); const rx = intervalBlocks[blockFromWeek(w)]; const spec = parseRx(rx); if(!spec) return; const {up, run, walk, reps, down} = spec; phaseQueue = [{label:'Warm-up',secs:up*60}, ...Array.from({length:reps}).flatMap((_,i)=>[{label:`Run ${i+1}/${reps}`,secs:run*60},{label:`Walk ${i+1}/${reps}`,secs:walk*60}]), {label:'Cooldown',secs:down*60}]; phaseIdx=0; remaining=phaseQueue[0].secs; $('timerPanel').classList.remove('hidden'); tick(); timerId=setInterval(tick,1000); screenWakeLock(); }
  function stopGuidedTimer(){ if(timerId){ clearInterval(timerId); timerId=null; } $('timerPanel').classList.add('hidden'); releaseWakeLock(); }
  function tick(){ if(remaining<=0){ phaseIdx++; if(phaseIdx>=phaseQueue.length){ stopGuidedTimer(); return; } remaining = phaseQueue[phaseIdx].secs; flash(); } $('timerPhase').textContent = phaseQueue[phaseIdx].label; $('timer').textContent = toMMSS(remaining); const next = phaseQueue[phaseIdx+1]; $('timerDetail').textContent = next ? `Next: ${next.label}` : 'Done'; remaining--; }
  function toMMSS(s){ const m=Math.floor(s/60), ss=s%60; return `${String(m).padStart(2,'0')}:${String(ss).padStart(2,'0')}`; }
  function flash(){ const panel=$('timerPanel'); panel.classList.add('ring-4','ring-yellow-400'); setTimeout(()=>panel.classList.remove('ring-4','ring-yellow-400'),500); }
  let wakeLock=null; async function screenWakeLock(){ try { if('wakeLock' in navigator) wakeLock = await navigator.wakeLock.request('screen'); } catch {} } function releaseWakeLock(){ try { wakeLock && wakeLock.release(); } catch {} }

  // ---------- Progress / Charts ----------
  function getAllLogsSorted(){ const arr = Object.entries(state.logs).map(([date, L])=>({date, ...L})); arr.sort((a,b)=> a.date.localeCompare(b.date)); return arr; }
  function movingAvg(vals, window=7){ const out=[]; for(let i=0;i<vals.length;i++){ const start=Math.max(0,i-window+1); const slice=vals.slice(start,i+1).filter(v=>v!=null); out.push(slice.length>1? slice.reduce((a,b)=>a+b,0)/slice.length : null); } return out; }
  function renderChartsAndTable(){ const data = getAllLogsSorted(); const labels = data.map(d=>d.date.slice(5)); const weight = data.map(d=> d.weight? Number(d.weight): null); const calActual = data.map(d=> d.caloriesActual? Number(d.caloriesActual): null); const pActual = data.map(d=> d.proteinActual? Number(d.proteinActual): null); const calTarget = data.map(()=> Number(state.settings.calTarget)); const wctx = $('weightChart')?.getContext('2d'); if(wctx){ if(state.charts.weight){ state.charts.weight.destroy(); } state.charts.weight = new Chart(wctx, { type:'line', data:{ labels, datasets:[ { label:'Daily', data: weight, spanGaps:true, pointRadius:1, borderWidth:2 }, { label:'7‑day avg', data: movingAvg(weight,7), spanGaps:true, pointRadius:0, borderDash:[6,4], borderWidth:2 } ]}, options:{ responsive:true, maintainAspectRatio:false, plugins:{ legend:{display:true} }, scales:{ y:{ beginAtZero:false } } }); }
    const cctx = $('caloriesChart')?.getContext('2d'); if(cctx){ if(state.charts.calories){ state.charts.calories.destroy(); } state.charts.calories = new Chart(cctx, { type:'line', data:{ labels, datasets:[ { label:'Target', data: calTarget, borderDash:[6,4], pointRadius:0, borderWidth:2 }, { label:'Actual', data: calActual, spanGaps:true, pointRadius:1, borderWidth:2 } ]}, options:{ responsive:true, maintainAspectRatio:false, plugins:{ legend:{display:true} }, scales:{ y:{ beginAtZero:false } } }); }
    const pctx = $('proteinChart')?.getContext('2d'); if(pctx){ if(state.charts.protein){ state.charts.protein.destroy(); } state.charts.protein = new Chart(pctx, { type:'line', data:{ labels, datasets:[ { label:'Protein (g)', data: pActual, spanGaps:true, pointRadius:1, borderWidth:2 } ]}, options:{ responsive:true, maintainAspectRatio:false, plugins:{ legend:{display:true} }, scales:{ y:{ beginAtZero:true } } }); }
    const tbody = $('recentTbody'); if(tbody){ const recent = data.slice(-14).reverse(); tbody.innerHTML = recent.map(r=>{ const yesNo = r.didWorkout? 'Y' : (r.didWorkout===false? 'N' : ''); const notes = (r.notes||'').toString().slice(0,60); return `<tr><td class="py-1 pr-3">${r.date}</td><td class="py-1 pr-3">${r.weight||''}</td><td class="py-1 pr-3">${r.caloriesActual||''}</td><td class="py-1 pr-3">${r.proteinActual||''}</td><td class="py-1 pr-3">${r.stepsActual||''}</td><td class="py-1 pr-3">${yesNo}</td><td class="py-1 pr-3">${notes}</td></tr>`; }).join(''); }
  }

  function exportCSV(){ const rows = [['Date','Calories','Protein','Fat','Carbs','Steps','Weight','Sleep','RestingHR','Workout','Notes']]; const data = getAllLogsSorted(); data.forEach(r=>{ rows.push([ r.date, r.caloriesActual||'', r.proteinActual||'', r.fatActual||'', r.carbActual||'', r.stepsActual||'', r.weight||'', r.sleep||'', r.rhr||'', r.didWorkout? 'Y':'', (r.notes||'').toString().replace(/\n/g,' ') ]); }); const csv = rows.map(r=> r.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',')).join('\n'); const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'cutcoach_export.csv'; a.click(); URL.revokeObjectURL(url); }

  // ---------- Events ----------
  $('openSettings').onclick = ()=>{ const s = state.settings; $('startDate').value=s.startDate; $('caloriesTarget').value=s.calTarget; $('proteinTarget').value=s.pTarget; $('fatTarget').value=s.fTarget; $('settings').classList.remove('hidden'); };
  $('closeSettings').onclick = ()=>$('settings').classList.add('hidden');
  $('saveSettings').onclick = ()=>{ const s={ startDate: $('startDate').value || state.settings.startDate, calTarget: Number($('caloriesTarget').value || 2300), pTarget: Number($('proteinTarget').value || 170), fTarget: Number($('fatTarget').value || 70) }; state.settings=s; saveSettings(s); $('settings').classList.add('hidden'); renderToday(); };
  $('intervalHelper').onclick = ()=>{ const w = weekNumber(state.settings.startDate, state.today); const block = blockFromWeek(w); $('blockLabel').textContent = `#${block}`; $('intervalLabel').textContent = intervalBlocks[block]; showDrawer(); };
  $('closeDrawer').onclick = hideDrawer; $('startIntervals').onclick = startGuidedTimer; $('stopTimer').onclick = stopGuidedTimer; $('saveBtn').onclick = saveToday; $('startTimer').onclick = ()=>{ $('drawer').classList.remove('hidden'); $('blockLabel').textContent='—'; $('intervalLabel').textContent='30:00 countdown'; phaseQueue=[{label:'Go',secs:1800}]; phaseIdx=0; remaining=phaseQueue[0].secs; $('timerPanel').classList.remove('hidden'); if(timerId) clearInterval(timerId); timerId=setInterval(tick,1000); screenWakeLock(); };
  const exportBtn = document.getElementById('exportCsvBtn'); if(exportBtn) exportBtn.addEventListener('click', exportCSV);

  // Kickoff
  renderToday();
  </script>
</body>
</html>